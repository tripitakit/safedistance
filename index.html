<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üöó</text></svg>" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Safe Distance Simulator</title>
    <!-- Critical inline styles for instant loading screen -->
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { background: #000; overflow: hidden; font-family: 'Courier New', monospace; }
      #app { display: none; }
      .loading-screen {
        position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
        background: linear-gradient(135deg, #000 0%, #001a00 50%, #000 100%);
        display: flex; justify-content: center; align-items: center; z-index: 9999;
      }
      .loading-content { text-align: center; }
      .loading-content h1 {
        color: #0f0; font-size: 64px; font-weight: bold;
        text-shadow: 0 0 30px rgba(0,255,0,0.8), 0 0 60px rgba(0,255,0,0.4);
        margin-bottom: 40px; letter-spacing: 8px;
        animation: lp 1.5s ease-in-out infinite;
      }
      @keyframes lp { 0%,100%{opacity:1} 50%{opacity:0.7} }
      .loading-bar {
        width: 300px; height: 8px; background: rgba(0,255,0,0.2);
        border: 2px solid #0f0; border-radius: 4px; margin: 0 auto 20px; overflow: hidden;
      }
      .loading-progress {
        height: 100%; width: 0%; background: linear-gradient(90deg, #0f0, #0ff, #0f0);
        background-size: 200% 100%; animation: lb 1.5s ease-in-out infinite;
      }
      @keyframes lb { 0%{width:0%} 50%{width:70%} 100%{width:100%} }
      .loading-text { color: #0f0; font-size: 18px; letter-spacing: 4px; animation: lt 0.8s ease-in-out infinite; }
      @keyframes lt { 0%,100%{opacity:1} 50%{opacity:0.5} }
    </style>
  </head>
  <body>
    <!-- Loading Screen - shows immediately -->
    <div id="loadingScreen" class="loading-screen">
      <div class="loading-content">
        <h1>SAFE DISTANCE</h1>
        <div class="loading-bar">
          <div class="loading-progress"></div>
        </div>
        <p class="loading-text">INITIALIZING...</p>
      </div>
    </div>

    <div id="app">
      <canvas id="canvas"></canvas>
      <!-- Visual effects overlay -->
      <div id="effectsOverlay">
        <div id="vignetteOverlay"></div>
        <div id="tensionOverlay"></div>
        <div id="speedLines"></div>
      </div>
      <div id="hud">
        <div id="warningTooClose" class="warning warning-danger hidden">‚ö†Ô∏è TOO CLOSE</div>
        <div id="warningSafe" class="warning warning-safe hidden">‚úì SAFE DISTANCE</div>

        <!-- Game Start Overlay -->
        <div id="gameStartOverlay" class="game-start-overlay">
          <h1>SAFE DISTANCE SIMULATOR</h1>
          <div class="start-instructions desktop-instructions">
            <p><strong>ENTER</strong> - Accelerate</p>
            <p><strong>SPACE</strong> - Brake (hold for more power)</p>
            <p class="start-hint">Press ENTER or SPACE to start</p>
          </div>
          <div class="start-instructions mobile-instructions hidden">
            <p><span class="btn-indicator accel">GO</span> - Accelerate</p>
            <p><span class="btn-indicator brake">BRAKE</span> - Brake (hold for more power)</p>
            <p class="start-hint">Tap a button to start</p>
          </div>
        </div>

        <!-- Top Center Score Display -->
        <div class="score-overlay">
          <div class="score-label">SCORE</div>
          <div id="scoreOverlay" class="score-value-overlay">0</div>
        </div>
      </div>

      <!-- Speedometer Gauge -->
      <canvas id="speedometer" class="speedometer" width="200" height="200"></canvas>

      <!-- Mobile Touch Controls -->
      <div id="mobileControls" class="mobile-controls hidden">
        <button id="brakeBtn" class="touch-btn brake-btn">BRAKE</button>
        <button id="accelBtn" class="touch-btn accel-btn">GO</button>
      </div>

      <!-- Crash Flash Overlay -->
      <div id="crashFlash" class="crash-flash hidden"></div>

      <!-- Game Over Screen -->
      <div id="gameOver" class="game-over hidden">
        <div class="crash-report">
          <h1>üí• COLLISION - GAME OVER</h1>

          <div class="crash-report-content">
            <div class="crash-details">
              <h2>CRASH REPORT</h2>
              <div class="stat-row">
                <span class="stat-label">Impact Force:</span>
                <span id="impactForce" class="stat-value">0 kN</span>
              </div>
              <div class="stat-row">
                <span class="stat-label">Speed Difference:</span>
                <span id="speedDiff" class="stat-value">0 km/h</span>
              </div>
              <div class="stat-row">
                <span class="stat-label">Your Speed:</span>
                <span id="crashYourSpeed" class="stat-value">0 km/h</span>
              </div>
              <div class="stat-row">
                <span class="stat-label">Lead Speed:</span>
                <span id="crashLeadSpeed" class="stat-value">0 km/h</span>
              </div>
              <div class="stat-row damage-row">
                <span class="stat-label">Estimated Damage:</span>
                <span id="damage" class="stat-value damage-level">SEVERE</span>
              </div>
              <div class="stat-row">
                <span class="stat-label">Distance Driven:</span>
                <span id="finalKm" class="stat-value">0.0 km</span>
              </div>
              <div class="stat-row">
                <span class="stat-label">Final Score:</span>
                <span id="finalScore" class="stat-value">0 pts</span>
              </div>
            </div>

            <!-- Player Health Report -->
            <div class="health-report player-health">
              <h2>üè• YOUR VEHICLE</h2>
              <div class="stat-row gforce-row">
                <span class="stat-label">G-Force:</span>
                <span id="gForce" class="stat-value gforce-value">0 g</span>
              </div>
              <div class="stat-row">
                <span class="stat-label">Driver:</span>
                <span id="patientStatus" class="stat-value patient-status">STABLE</span>
              </div>
              <div class="injuries-section">
                <span class="stat-label">Injuries:</span>
                <ul id="injuriesList" class="injuries-list">
                  <li>No injuries detected</li>
                </ul>
              </div>
              <div class="stat-row prognosis-row">
                <span class="stat-label">Prognosis:</span>
                <span id="prognosis" class="stat-value prognosis-value">Good</span>
              </div>
            </div>

            <!-- Lead Car Occupants Health Report -->
            <div id="leadHealthSection" class="health-report lead-health hidden">
              <h2>üöó LEAD VEHICLE</h2>
              <div class="stat-row">
                <span class="stat-label">Occupants:</span>
                <span id="leadOccupants" class="stat-value occupant-count">1 person</span>
              </div>
              <div id="leadOccupantsList" class="occupants-list">
                <!-- Dynamically populated -->
              </div>
            </div>

            <!-- Rear Car Occupants Health Report -->
            <div id="rearHealthSection" class="health-report rear-health hidden">
              <h2>üöô REAR VEHICLE</h2>
              <div class="stat-row">
                <span class="stat-label">Occupants:</span>
                <span id="rearOccupants" class="stat-value occupant-count">1 person</span>
              </div>
              <div id="rearOccupantsList" class="occupants-list">
                <!-- Dynamically populated -->
              </div>
            </div>
          </div>

          <div class="crash-report-buttons">
            <button id="restartBtn" class="restart-btn">RESTART</button>
            <button id="viewHighScoresBtn" class="view-scores-btn">HIGH SCORES</button>
          </div>
        </div>
      </div>

      <!-- High Score Name Input Overlay -->
      <div id="highScoreNameInput" class="high-score-input hidden">
        <div class="high-score-panel">
          <h1>üèÜ NEW HIGH SCORE! üèÜ</h1>
          <div class="high-score-message">
            <p>Congratulations! Your score of <span id="newHighScore" class="highlight-score">0</span> pts</p>
            <p>made it to the TOP 10!</p>
          </div>
          <div class="name-input-section">
            <label for="playerNameInput">Enter Your Name:</label>
            <input type="text" id="playerNameInput" maxlength="20" placeholder="Your Name" autocomplete="off">
            <button id="submitNameBtn" class="submit-name-btn">SUBMIT</button>
          </div>
        </div>
      </div>

      <!-- High Scores Display -->
      <div id="highScoresDisplay" class="high-scores-display hidden">
        <div class="high-scores-panel">
          <h1>üèÜ TOP 10 HIGH SCORES üèÜ</h1>
          <div class="high-scores-list" id="highScoresList">
            <!-- High scores will be populated here -->
          </div>
          <button id="closeHighScoresBtn" class="close-scores-btn">CLOSE</button>
        </div>
      </div>
    </div>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
